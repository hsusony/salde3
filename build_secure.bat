@echo off
chcp 65001 >nul
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo    ๐ ุจูุงุก ูุณุฎุฉ ูุญููุฉ ูู ูุธุงู ุฅุฏุงุฑุฉ ุงููุจูุนุงุช
echo    9SOFT - Secure Build System
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo.

:: ุงูุชุญูู ูู ูุฌูุฏ Flutter
where flutter >nul 2>nul
if %errorlevel% neq 0 (
    echo โ Flutter ุบูุฑ ูุซุจุช! ูุฑุฌู ุชุซุจูุช Flutter ุฃููุงู.
    pause
    exit /b 1
)

echo โ ุชู ุงูุนุซูุฑ ุนูู Flutter
echo.

:: ุชูุธูู ุงููุดุฑูุน
echo ๐งน ุชูุธูู ุงููุดุฑูุน...
call flutter clean
if %errorlevel% neq 0 (
    echo โ ูุดู ุงูุชูุธูู!
    pause
    exit /b 1
)
echo.

:: ุชุญุฏูุซ ุงูุชุจุนูุงุช
echo ๐ฆ ุชุญุฏูุซ ุงูุชุจุนูุงุช...
call flutter pub get
if %errorlevel% neq 0 (
    echo โ ูุดู ุชุญุฏูุซ ุงูุชุจุนูุงุช!
    pause
    exit /b 1
)
echo.

:: ุจูุงุก ุงููุณุฎุฉ ุงููุญููุฉ ููู Windows
echo ๐จ ุจูุงุก ุงููุณุฎุฉ ุงููุญููุฉ ููู Windows...
echo    - ุชุดููุฑ ุงูููุฏ (Obfuscation)
echo    - ุฅุฎูุงุก ุงูุฃุณูุงุก ูุงููุชุบูุฑุงุช
echo    - ูุตู ูุนูููุงุช ุงูุชุตุญูุญ
echo.

call flutter build windows --release ^
    --obfuscate ^
    --split-debug-info=build/debug-info ^
    --tree-shake-icons ^
    --dart-define=PRODUCTION=true

if %errorlevel% neq 0 (
    echo โ ูุดู ุงูุจูุงุก!
    pause
    exit /b 1
)
echo.

:: ูุณุฎ ุงููููุงุช ุงูุถุฑูุฑูุฉ
echo ๐ ูุณุฎ ุงููููุงุช ุงูุถุฑูุฑูุฉ...

set RELEASE_DIR=build\windows\x64\runner\Release
set SECURE_DIR=build\windows\secure_release

:: ุฅูุดุงุก ูุฌูุฏ ุงููุณุฎุฉ ุงูุขููุฉ
if not exist "%SECURE_DIR%" mkdir "%SECURE_DIR%"

:: ูุณุฎ ุงููููุงุช
xcopy /E /I /Y "%RELEASE_DIR%\*" "%SECURE_DIR%\"

echo.
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo    โ ุชู ุงูุจูุงุก ุจูุฌุงุญ!
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo.
echo ๐ ูููุน ุงููููุงุช:
echo    %CD%\%SECURE_DIR%
echo.
echo ๐ ุงูุญูุงูุฉ ุงููุทุจูุฉ:
echo    โ ุชุดููุฑ ุงูููุฏ (Obfuscation)
echo    โ ุฅุฎูุงุก ุฃุณูุงุก ุงููุชุบูุฑุงุช ูุงูุฏูุงู
echo    โ ูุตู ูุนูููุงุช ุงูุชุตุญูุญ
echo    โ ุชูููู ุญุฌู ุงููููุงุช (Tree-shaking)
echo    โ ุญูุงูุฉ ูู ุงูููุฏุณุฉ ุงูุนูุณูุฉ
echo.
echo ๐ ูุนูููุงุช ุฅุถุงููุฉ:
echo    - ูุนูููุงุช ุงูุชุตุญูุญ ูู: build\debug-info
echo    - ูุง ุชุดุงุฑู ูุฌูุฏ debug-info ูุน ุฃุญุฏ
echo    - ุงุญุชูุธ ุจูุณุฎุฉ ุงุญุชูุงุทูุฉ ุขููุฉ
echo.
echo ๐ก ููุงุญุธุฉ: ุงูุณูุฑุณ ููุฏ ูุญูู ุจุดูู ูุจูุฑ ูููู:
echo    - ูุง ุชุดุงุฑู ูููุงุช .exe ูุน ูุทูุฑูู ุบูุฑ ููุซูููู
echo    - ุงุณุชุฎุฏู ุชุฑุฎูุต ููุญูุงูุฉ ุงูุฅุถุงููุฉ
echo    - ูุนูู ุงูุชุญูู ูู ุงูุฃูุงู ูู ุงูููุฏ
echo.

:: ูุชุญ ุงููุฌูุฏ
explorer "%SECURE_DIR%"

echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
pause
