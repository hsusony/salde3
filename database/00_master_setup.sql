-- =============================================
-- Master Setup Script - SQL Server Database
-- السكريبت الرئيسي لإنشاء قاعدة البيانات الكاملة
-- =============================================

-- هذا الملف ينفذ جميع السكريبتات بالترتيب الصحيح

PRINT N'';
PRINT N'╔════════════════════════════════════════════════════════════════╗';
PRINT N'║  Sales Management System - Database Setup                     ║';
PRINT N'║  نظام إدارة المبيعات - إعداد قاعدة البيانات                  ║';
PRINT N'╚════════════════════════════════════════════════════════════════╝';
PRINT N'';
PRINT N'⏳ جاري البدء في عملية الإنشاء...';
PRINT N'';
GO

-- =============================================
-- الخطوة 1: إنشاء الجداول الأساسية
-- =============================================
PRINT N'';
PRINT N'╔════════════════════════════════════════════════════════════════╗';
PRINT N'║  الخطوة 1/6: إنشاء الجداول الأساسية                          ║';
PRINT N'╚════════════════════════════════════════════════════════════════╝';
GO

:r create_database.sql

-- =============================================
-- الخطوة 2: إنشاء الجداول الإضافية
-- =============================================
PRINT N'';
PRINT N'╔════════════════════════════════════════════════════════════════╗';
PRINT N'║  الخطوة 2/6: إنشاء الجداول الإضافية                          ║';
PRINT N'╚════════════════════════════════════════════════════════════════╝';
GO

:r 02_additional_tables.sql

-- =============================================
-- الخطوة 3: إنشاء الإجراءات المخزنة
-- =============================================
PRINT N'';
PRINT N'╔════════════════════════════════════════════════════════════════╗';
PRINT N'║  الخطوة 3/6: إنشاء الإجراءات المخزنة (Stored Procedures)      ║';
PRINT N'╚════════════════════════════════════════════════════════════════╝';
GO

:r 03_stored_procedures.sql

-- =============================================
-- الخطوة 4: إنشاء العروض (Views)
-- =============================================
PRINT N'';
PRINT N'╔════════════════════════════════════════════════════════════════╗';
PRINT N'║  الخطوة 4/6: إنشاء العروض (Views) للتقارير                   ║';
PRINT N'╚════════════════════════════════════════════════════════════════╝';
GO

:r 04_views.sql

-- =============================================
-- الخطوة 5: إنشاء المشغلات (Triggers)
-- =============================================
PRINT N'';
PRINT N'╔════════════════════════════════════════════════════════════════╗';
PRINT N'║  الخطوة 5/6: إنشاء المشغلات (Triggers)                        ║';
PRINT N'╚════════════════════════════════════════════════════════════════╝';
GO

:r 05_triggers.sql

-- =============================================
-- الخطوة 6: إدخال البيانات الأولية
-- =============================================
PRINT N'';
PRINT N'╔════════════════════════════════════════════════════════════════╗';
PRINT N'║  الخطوة 6/6: إدخال البيانات الأولية                           ║';
PRINT N'╚════════════════════════════════════════════════════════════════╝';
GO

:r 06_initial_data.sql

-- =============================================
-- عرض الملخص النهائي
-- =============================================
USE SalesManagementDB;
GO

PRINT N'';
PRINT N'';
PRINT N'╔════════════════════════════════════════════════════════════════╗';
PRINT N'║                      ملخص قاعدة البيانات                      ║';
PRINT N'║                    Database Summary                           ║';
PRINT N'╚════════════════════════════════════════════════════════════════╝';
PRINT N'';

-- عدد الجداول
DECLARE @tableCount INT;
SELECT @tableCount = COUNT(*) FROM sys.tables WHERE type = 'U';
PRINT N'📊 عدد الجداول: ' + CAST(@tableCount AS NVARCHAR);

-- عدد الإجراءات المخزنة
DECLARE @spCount INT;
SELECT @spCount = COUNT(*) FROM sys.procedures;
PRINT N'⚙️  عدد الإجراءات المخزنة: ' + CAST(@spCount AS NVARCHAR);

-- عدد العروض (Views)
DECLARE @viewCount INT;
SELECT @viewCount = COUNT(*) FROM sys.views;
PRINT N'👁️  عدد العروض (Views): ' + CAST(@viewCount AS NVARCHAR);

-- عدد المشغلات (Triggers)
DECLARE @triggerCount INT;
SELECT @triggerCount = COUNT(*) FROM sys.triggers;
PRINT N'⚡ عدد المشغلات (Triggers): ' + CAST(@triggerCount AS NVARCHAR);

PRINT N'';
PRINT N'╔════════════════════════════════════════════════════════════════╗';
PRINT N'║                      الجداول المنشأة                          ║';
PRINT N'╚════════════════════════════════════════════════════════════════╝';

SELECT 
    ROW_NUMBER() OVER (ORDER BY name) AS '#',
    name AS [اسم الجدول / Table Name]
FROM sys.tables 
WHERE type = 'U'
ORDER BY name;

PRINT N'';
PRINT N'╔════════════════════════════════════════════════════════════════╗';
PRINT N'║                    بيانات الدخول الافتراضية                   ║';
PRINT N'║                  Default Login Credentials                    ║';
PRINT N'╚════════════════════════════════════════════════════════════════╝';
PRINT N'';
PRINT N'  👤 اسم المستخدم / Username: admin';
PRINT N'  🔑 كلمة المرور / Password:  admin123';
PRINT N'';
PRINT N'  ⚠️  تحذير: يُنصح بتغيير كلمة المرور فوراً!';
PRINT N'  ⚠️  Warning: Change password immediately!';
PRINT N'';

PRINT N'';
PRINT N'╔════════════════════════════════════════════════════════════════╗';
PRINT N'║                     ✅ اكتمل الإعداد بنجاح!                    ║';
PRINT N'║                ✅ Setup Completed Successfully!                ║';
PRINT N'╚════════════════════════════════════════════════════════════════╝';
PRINT N'';
PRINT N'🎉 قاعدة البيانات جاهزة للاستخدام!';
PRINT N'🎉 The database is ready to use!';
PRINT N'';
PRINT N'📌 الخطوات التالية:';
PRINT N'   1. تحديث إعدادات الاتصال في التطبيق';
PRINT N'   2. تشغيل التطبيق والدخول باستخدام بيانات المدير';
PRINT N'   3. تغيير كلمة المرور من إعدادات النظام';
PRINT N'';
PRINT N'📚 للمزيد من المعلومات، راجع ملف README_SQL_SERVER.md';
PRINT N'';
GO
